diff --git a/src/Common/VMScript.js b/src/Common/VMScript.js
index f83d758d92d67528ada004b0a3d4379fb3afcec4..84542a774e9e6c1ac7a100f474891901af1ed2a5 100644
--- a/src/Common/VMScript.js
+++ b/src/Common/VMScript.js
@@ -35,6 +35,20 @@ class VMScript {
     }
 
     try {
+      // LavaMoat does not support ESM
+      const sourceMapImport = 'import ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from "../../node_modules/css-loader/dist/runtime/sourceMaps.js";'
+      if (code.includes(sourceMapImport)){
+        code = code.replace(sourceMapImport, `var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require('../../node_modules/css-loader/dist/runtime/sourceMaps.js');`)
+      }
+      const apiImport = 'import ___CSS_LOADER_API_IMPORT___ from "../../node_modules/css-loader/dist/runtime/api.js";'
+      if (code.includes(apiImport)){
+        code = code.replace(apiImport, `var ___CSS_LOADER_API_IMPORT___ = require('../../node_modules/css-loader/dist/runtime/api.js');`)
+      }
+      const getUrlImport = 'import ___CSS_LOADER_GET_URL_IMPORT___ from "../../node_modules/css-loader/dist/runtime/getUrl.js";'
+      if (code.includes(getUrlImport)){
+        code = code.replace(getUrlImport, `var ___CSS_LOADER_GET_URL_IMPORT___ = require('../../node_modules/css-loader/dist/runtime/getUrl.js');`)
+      }
+
       const script = new vm.Script(code, { filename });
       let result = script.runInContext(this.context);
 
