name: MetaMask Security Code Scanner

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ !(contains(github.ref, 'refs/heads/main') || contains(github.ref, 'refs/heads/stable')) }}

jobs:
  run-security-scan:
    uses: MetaMask/action-security-code-scanner/.github/workflows/security-scan.yml@v2
    permissions:
      actions: read
      contents: read
      security-events: write
    with:
      repo: ${{ github.repository }}
      scanner-ref: v2
      paths-ignored: |
        test/
        docs/
        storybook/
        .storybook/
        **/*.test.js
        **/*.test.ts
        **/*.test.jsx
        **/*.test.tsx
        **/*.stories.tsx
        development/chromereload.js
        node_modules
    secrets:
      project-metrics-token: ${{ secrets.SECURITY_SCAN_METRICS_TOKEN }}
      slack-webhook: ${{ secrets.APPSEC_BOT_SLACK_WEBHOOK }}
